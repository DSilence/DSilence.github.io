<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Sleepy Maniac Blog]]></title><description><![CDATA[Блог за авторством Дмитрия Сафарова. Пишу код, развлекаюсь, путешествую, фотографирую.]]></description><link>https://blog.sleepymaniac.com</link><generator>RSS for Node</generator><lastBuildDate>Sun, 12 Aug 2018 07:56:19 GMT</lastBuildDate><item><title><![CDATA[Spatial типы и EFCore]]></title><description><![CDATA[Как известно, EFCore по умолчанию не работает со Spatial типами. Тикет об их поддержке уже даавно лежит на  гитхабе . Увы, скорее всего…]]></description><link>https://blog.sleepymaniac.com/_posts/2017-09-28-spatial-d182d0b8d0bfd18b-d0b8-efcore/</link><guid isPermaLink="false">https://blog.sleepymaniac.com/_posts/2017-09-28-spatial-d182d0b8d0bfd18b-d0b8-efcore/</guid><pubDate>Thu, 28 Sep 2017 11:50:41 GMT</pubDate><content:encoded>&lt;p&gt;Как известно, EFCore по умолчанию не работает со Spatial типами. Тикет об их поддержке уже даавно лежит на &lt;a href=&quot;https://github.com/aspnet/EntityFrameworkCore/issues/1100&quot;&gt;гитхабе&lt;/a&gt;. Увы, скорее всего ждать полноценной поддержки придётся ещё долго. Но варианты есть! Ниже можно увидеть доступные нам опции. &lt;!-- more --&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We go back in time. EF6 всё ещё есть, он работает, и в нём есть поддержка spatial типов через DbGeography и DbGeometry классы.&lt;/li&gt;
&lt;/ol&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Вооружившись знанием о том, что в efcore 2 появилась возможность определять свои &lt;a href=&quot;https://github.com/aspnet/EntityFrameworkCore/issues/7434&quot;&gt;type mappings&lt;/a&gt;, прикрутить поддержку SqlServerTypes. Этот вариант будет работать только на windows, зато очень удобен.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Именно второй вариант мы и будем рассматривать. Для начала, создадим свой type mapping:&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist81001569&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-geographytypemapping-cs&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;blob-wrapper data type-c&quot;&gt;
      &lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;GeographyTypeMapping&lt;/span&gt; : &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;GeographyTypeMapping&lt;/span&gt;([&lt;span class=&quot;pl-en&quot;&gt;NotNull&lt;/span&gt;] &lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;storeType&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;DbType&lt;/span&gt;? &lt;span class=&quot;pl-smi&quot;&gt;dbType&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;) &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            : &lt;span class=&quot;pl-k&quot;&gt;base&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;storeType&lt;/span&gt;, &lt;span class=&quot;pl-k&quot;&gt;typeof&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;SqlGeography&lt;/span&gt;), &lt;span class=&quot;pl-smi&quot;&gt;dbType&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;DbParameter&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;CreateParameter&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;DbCommand&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;command&lt;/span&gt;, &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;name&lt;/span&gt;, &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;, &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;bool&lt;/span&gt;? &lt;span class=&quot;pl-smi&quot;&gt;nullable&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;bool&lt;/span&gt;?))&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;pl-smi&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;ArgumentNullException&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;nameof&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;command&lt;/span&gt;));&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;command&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;CreateParameter&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Direction&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;ParameterDirection&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Input&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;ParameterName&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;name&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;??&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;DBNull&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Value&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;pl-smi&quot;&gt;nullable&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;HasValue&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;IsNullable&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;nullable&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Value&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;SqlParameter&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;sqlParameter&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;sqlParameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;SqlDbType&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;SqlDbType&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Udt&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;sqlParameter&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;UdtTypeName&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;SqlServerConstants&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;GeographyDataType&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L30&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;30&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC30&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-en&quot;&gt;ConfigureParameter&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L31&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;31&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC31&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;parameter&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L32&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;32&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC32&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L33&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;33&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC33&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L34&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;34&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC34&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;Clone&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;storeType&lt;/span&gt;, &lt;span class=&quot;pl-k&quot;&gt;int&lt;/span&gt;? &lt;span class=&quot;pl-smi&quot;&gt;size&lt;/span&gt;) &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L35&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;35&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC35&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;GeographyTypeMapping&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;storeType&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;DbType&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L36&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;36&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC36&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L37&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;37&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC37&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;GenerateNonNullSqlLiteral&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L38&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;38&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC38&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L39&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;39&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC39&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; ((&lt;span class=&quot;pl-en&quot;&gt;SqlGeography&lt;/span&gt;)&lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;).&lt;span class=&quot;pl-en&quot;&gt;ToWkt&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L40&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;40&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC40&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-L41&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;41&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-geographytypemapping-cs-LC41&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/GeographyTypeMapping.cs&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-geographytypemapping-cs&quot;&gt;GeographyTypeMapping.cs&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;Далее, нам нужно добавить в SqlServerTypeMapper новый маппинг. Расширяем класс:&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist81001569&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-customsqlservertypemapper-cs&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;blob-wrapper data type-c&quot;&gt;
      &lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;CustomSqlServerTypeMapper&lt;/span&gt; : &lt;span class=&quot;pl-en&quot;&gt;SqlServerTypeMapper&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;DbGeographyTypeMapping&lt;/span&gt; &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;GeographyTypeMapping&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;SqlServerConstants&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;GeographyDataType&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;IReadOnlyDictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;pl-en&quot;&gt;Type&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt;&amp;gt; &lt;span class=&quot;pl-smi&quot;&gt;_clrTypeMappings&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;IReadOnlyDictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt;&amp;gt; &lt;span class=&quot;pl-smi&quot;&gt;_storeTypeMapping&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L8&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;8&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC8&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L9&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;9&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC9&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;CustomSqlServerTypeMapper&lt;/span&gt;(&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L10&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;10&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC10&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            [&lt;span class=&quot;pl-en&quot;&gt;NotNull&lt;/span&gt;] &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapperDependencies&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;dependencies&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L11&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;11&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC11&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            : &lt;span class=&quot;pl-k&quot;&gt;base&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;dependencies&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L12&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;12&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC12&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L13&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;13&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC13&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L14&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;14&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC14&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L15&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;15&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC15&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;override&lt;/span&gt; IReadOnlyDictionary&amp;lt;Type, RelationalTypeMapping&amp;gt; &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L16&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;16&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC16&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-en&quot;&gt;GetClrTypeMappings&lt;/span&gt;()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L17&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;17&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC17&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L18&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;18&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC18&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;//&lt;/span&gt; Not synchronized but we don&amp;#39;t really care&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L19&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;19&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC19&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;pl-smi&quot;&gt;_clrTypeMappings&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L20&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;20&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC20&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L21&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;21&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC21&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;base&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;GetClrTypeMappings&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L22&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;22&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC22&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;clrTypeMappings&lt;/span&gt; &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L23&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;23&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC23&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                    &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;Dictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;pl-en&quot;&gt;Type&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt;&amp;gt;(&lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Count&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L24&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;24&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC24&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-k&quot;&gt;foreach&lt;/span&gt; (&lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L25&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;25&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC25&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L26&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;26&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC26&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                    &lt;span class=&quot;pl-smi&quot;&gt;clrTypeMappings&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Add&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Key&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Value&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L27&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;27&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC27&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L28&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;28&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC28&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L29&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;29&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC29&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;clrTypeMappings&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Add&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;typeof&lt;/span&gt;(&lt;span class=&quot;pl-en&quot;&gt;SqlGeography&lt;/span&gt;), &lt;span class=&quot;pl-smi&quot;&gt;DbGeographyTypeMapping&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L30&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;30&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC30&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;_clrTypeMappings&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;clrTypeMappings&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L31&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;31&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC31&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L32&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;32&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC32&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L33&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;33&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC33&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;_clrTypeMappings&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L34&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;34&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC34&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L35&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;35&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC35&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L36&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;36&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC36&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;override&lt;/span&gt; IReadOnlyDictionary&amp;lt;string, RelationalTypeMapping&amp;gt; &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L37&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;37&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC37&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-en&quot;&gt;GetStoreTypeMappings&lt;/span&gt;()&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L38&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;38&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC38&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L39&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;39&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC39&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;//&lt;/span&gt; Not synchronized but we don&amp;#39;t really care&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L40&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;40&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC40&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;pl-smi&quot;&gt;_storeTypeMapping&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;null&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L41&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;41&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC41&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L42&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;42&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC42&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;base&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;GetStoreTypeMappings&lt;/span&gt;();&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L43&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;43&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC43&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;storeTypeMappings&lt;/span&gt; &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L44&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;44&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC44&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                    &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;Dictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;pl-k&quot;&gt;string&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapping&lt;/span&gt;&amp;gt;(&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L45&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;45&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC45&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                        &lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Count&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L46&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;46&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC46&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-k&quot;&gt;foreach&lt;/span&gt; (&lt;span class=&quot;pl-k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;baseDictionary&lt;/span&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L47&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;47&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC47&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L48&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;48&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC48&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                    &lt;span class=&quot;pl-smi&quot;&gt;storeTypeMappings&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Add&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Key&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;keyValuePair&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;Value&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L49&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;49&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC49&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L50&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;50&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC50&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L51&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;51&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC51&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;storeTypeMappings&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Add&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;SqlServerConstants&lt;/span&gt;.&lt;span class=&quot;pl-smi&quot;&gt;GeographyDataType&lt;/span&gt;, &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L52&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;52&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC52&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                    &lt;span class=&quot;pl-smi&quot;&gt;DbGeographyTypeMapping&lt;/span&gt;);&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L53&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;53&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC53&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;                &lt;span class=&quot;pl-smi&quot;&gt;_storeTypeMapping&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;storeTypeMappings&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L54&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;54&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC54&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L55&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;55&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC55&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;
&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L56&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;56&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC56&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;_storeTypeMapping&lt;/span&gt;;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L57&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;57&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC57&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-L58&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;58&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-customsqlservertypemapper-cs-LC58&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/CustomSqlServerTypeMapper.cs&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-customsqlservertypemapper-cs&quot;&gt;CustomSqlServerTypeMapper.cs&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;Здесь можно озаботиться синхронизацией, но основная идея – переопределить методы GetClrTypeMappings и GetStoreTypeMappings добавив в них наш маппинг для географии.&lt;/p&gt;
&lt;p&gt;Далее осталось подменить IRelationalTypeMapper сервис нашей реализацией. Можно это сделать в ConfigureServices методе, а можно в вашем контексте переопределить OnConfiguring:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;OnConfiguring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;DbContextOptionsBuilder&lt;/span&gt; optionsBuilder&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  optionsBuilder
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReplaceService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;OnConfiguring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;optionsBuilder&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Всё? Почти.&lt;/p&gt;
&lt;p&gt;Если вы используете InMemory провайдер для тестирования, вам нужно провернуть такую же фишку и в нём. К счастью, поддержка type mappings уже &lt;a href=&quot;https://github.com/aspnet/EntityFrameworkCore/issues/8010&quot;&gt;доступна&lt;/a&gt;. Здесь вам надо зарегистрировать в DI другой интерфейс (ITypeMapper вместо IRelationalTypeMapper). Загвоздка заключается в том, что при добавлении регистрации InMemoryDatabase через UseInMemoryDatabase не происходит регистрация класса RelationalTypeMapperDependencies, в итоге его нельзя просто подменить через ReplaceService. Что делать?&lt;/p&gt;
&lt;p&gt;Создаём ещё одного наследника:&lt;/p&gt;
&lt;p&gt;&lt;div id=&quot;gist81001569&quot; class=&quot;gist&quot;&gt;
    &lt;div class=&quot;gist-file&quot;&gt;
      &lt;div class=&quot;gist-data&quot;&gt;
        &lt;div class=&quot;js-gist-file-update-container js-task-list-container file-box&quot;&gt;
  &lt;div id=&quot;file-testtypemapper-cs&quot; class=&quot;file&quot;&gt;
    

  &lt;div itemprop=&quot;text&quot; class=&quot;blob-wrapper data type-c&quot;&gt;
      &lt;table class=&quot;highlight tab-size js-file-line-container&quot; data-tab-size=&quot;8&quot;&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L1&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;1&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC1&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;TestTypeMapper&lt;/span&gt; : &lt;span class=&quot;pl-en&quot;&gt;CustomSqlServerTypeMapper&lt;/span&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L2&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC2&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L3&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;3&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC3&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        &lt;span class=&quot;pl-k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;TestTypeMapper&lt;/span&gt;() &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L4&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;4&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC4&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;            : &lt;span class=&quot;pl-k&quot;&gt;base&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;RelationalTypeMapperDependencies&lt;/span&gt;())&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L5&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;5&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC5&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        {&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L6&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;6&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC6&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;        }&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
        &lt;td id=&quot;file-testtypemapper-cs-L7&quot; class=&quot;blob-num js-line-number&quot; data-line-number=&quot;7&quot;&gt;&lt;/td&gt;
        &lt;td id=&quot;file-testtypemapper-cs-LC7&quot; class=&quot;blob-code blob-code-inner js-file-line&quot;&gt;    }&lt;/td&gt;
      &lt;/tr&gt;
&lt;/table&gt;


  &lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;

      &lt;/div&gt;
      &lt;div class=&quot;gist-meta&quot;&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/TestTypeMapper.cs&quot; style=&quot;float:right&quot;&gt;view raw&lt;/a&gt;
        &lt;a href=&quot;https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-testtypemapper-cs&quot;&gt;TestTypeMapper.cs&lt;/a&gt;
        hosted with &amp;#10084; by &lt;a href=&quot;https://github.com&quot;&gt;GitHub&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;После чего мы в наших тестах мы можем делать следующее:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;YourContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DbContextOptionsBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseInMemoryDatabase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;“Test”&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReplaceService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Вуаля!&lt;/p&gt;</content:encoded></item></channel></rss>