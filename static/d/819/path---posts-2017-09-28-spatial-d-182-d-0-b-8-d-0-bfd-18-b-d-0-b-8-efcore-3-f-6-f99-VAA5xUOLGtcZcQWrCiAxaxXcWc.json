{"data":{"site":{"siteMetadata":{"title":"Sleepy Maniac Blog","author":"Dzmitry Safarau"}},"markdownRemark":{"id":"e54b7169-18f5-5e0a-b161-d110b140da8d","html":"<p>Как известно, EFCore по умолчанию не работает со Spatial типами. Тикет об их поддержке уже даавно лежит на <a href=\"https://github.com/aspnet/EntityFrameworkCore/issues/1100\">гитхабе</a>. Увы, скорее всего ждать полноценной поддержки придётся ещё долго. Но варианты есть! Ниже можно увидеть доступные нам опции. <!-- more --></p>\n<ol>\n<li>We go back in time. EF6 всё ещё есть, он работает, и в нём есть поддержка spatial типов через DbGeography и DbGeometry классы.</li>\n</ol>\n<ol start=\"2\">\n<li>Вооружившись знанием о том, что в efcore 2 появилась возможность определять свои <a href=\"https://github.com/aspnet/EntityFrameworkCore/issues/7434\">type mappings</a>, прикрутить поддержку SqlServerTypes. Этот вариант будет работать только на windows, зато очень удобен.</li>\n</ol>\n<p>Именно второй вариант мы и будем рассматривать. Для начала, создадим свой type mapping:</p>\n<p><div id=\"gist81001569\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-geographytypemapping-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"blob-wrapper data type-c\">\n      <table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-geographytypemapping-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">GeographyTypeMapping</span> : <span class=\"pl-en\">RelationalTypeMapping</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-geographytypemapping-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\">    {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-geographytypemapping-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">public</span> <span class=\"pl-en\">GeographyTypeMapping</span>([<span class=\"pl-en\">NotNull</span>] <span class=\"pl-k\">string</span> <span class=\"pl-smi\">storeType</span>, <span class=\"pl-en\">DbType</span>? <span class=\"pl-smi\">dbType</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>) </td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-geographytypemapping-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\">            : <span class=\"pl-k\">base</span>(<span class=\"pl-smi\">storeType</span>, <span class=\"pl-k\">typeof</span>(<span class=\"pl-en\">SqlGeography</span>), <span class=\"pl-smi\">dbType</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-geographytypemapping-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-geographytypemapping-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-geographytypemapping-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-geographytypemapping-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">public</span> <span class=\"pl-k\">override</span> <span class=\"pl-en\">DbParameter</span> <span class=\"pl-en\">CreateParameter</span>(<span class=\"pl-en\">DbCommand</span> <span class=\"pl-smi\">command</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-geographytypemapping-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">string</span> <span class=\"pl-smi\">name</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-geographytypemapping-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">object</span> <span class=\"pl-smi\">value</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-geographytypemapping-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">bool</span>? <span class=\"pl-smi\">nullable</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">default</span>(<span class=\"pl-k\">bool</span>?))</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-geographytypemapping-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-geographytypemapping-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">command</span> <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-geographytypemapping-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\">            {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-geographytypemapping-cs-LC15\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">ArgumentNullException</span>(<span class=\"pl-k\">nameof</span>(<span class=\"pl-smi\">command</span>));</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-geographytypemapping-cs-LC16\" class=\"blob-code blob-code-inner js-file-line\">            }</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-geographytypemapping-cs-LC17\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-geographytypemapping-cs-LC18\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">var</span> <span class=\"pl-smi\">parameter</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">command</span>.<span class=\"pl-en\">CreateParameter</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-geographytypemapping-cs-LC19\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">parameter</span>.<span class=\"pl-smi\">Direction</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ParameterDirection</span>.<span class=\"pl-smi\">Input</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-geographytypemapping-cs-LC20\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">parameter</span>.<span class=\"pl-smi\">ParameterName</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">name</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-geographytypemapping-cs-LC21\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">parameter</span>.<span class=\"pl-smi\">Value</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">value</span> <span class=\"pl-k\">??</span> <span class=\"pl-smi\">DBNull</span>.<span class=\"pl-smi\">Value</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-geographytypemapping-cs-LC22\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">nullable</span>.<span class=\"pl-smi\">HasValue</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-geographytypemapping-cs-LC23\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">parameter</span>.<span class=\"pl-smi\">IsNullable</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">nullable</span>.<span class=\"pl-smi\">Value</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-geographytypemapping-cs-LC24\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">parameter</span> <span class=\"pl-k\">is</span> <span class=\"pl-en\">SqlParameter</span> <span class=\"pl-smi\">sqlParameter</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-geographytypemapping-cs-LC25\" class=\"blob-code blob-code-inner js-file-line\">            {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-geographytypemapping-cs-LC26\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">sqlParameter</span>.<span class=\"pl-smi\">SqlDbType</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">SqlDbType</span>.<span class=\"pl-smi\">Udt</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-geographytypemapping-cs-LC27\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">sqlParameter</span>.<span class=\"pl-smi\">UdtTypeName</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">SqlServerConstants</span>.<span class=\"pl-smi\">GeographyDataType</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-geographytypemapping-cs-LC28\" class=\"blob-code blob-code-inner js-file-line\">            }</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-geographytypemapping-cs-LC29\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-geographytypemapping-cs-LC30\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-en\">ConfigureParameter</span>(<span class=\"pl-smi\">parameter</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-geographytypemapping-cs-LC31\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">return</span> <span class=\"pl-smi\">parameter</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-geographytypemapping-cs-LC32\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-geographytypemapping-cs-LC33\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-geographytypemapping-cs-LC34\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">public</span> <span class=\"pl-k\">override</span> <span class=\"pl-en\">RelationalTypeMapping</span> <span class=\"pl-en\">Clone</span>(<span class=\"pl-k\">string</span> <span class=\"pl-smi\">storeType</span>, <span class=\"pl-k\">int</span>? <span class=\"pl-smi\">size</span>) </td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-geographytypemapping-cs-LC35\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">=&gt;</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">GeographyTypeMapping</span>(<span class=\"pl-smi\">storeType</span>, <span class=\"pl-smi\">DbType</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-geographytypemapping-cs-LC36\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-geographytypemapping-cs-LC37\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">protected</span> <span class=\"pl-k\">override</span> <span class=\"pl-k\">string</span> <span class=\"pl-en\">GenerateNonNullSqlLiteral</span>(<span class=\"pl-k\">object</span> <span class=\"pl-smi\">value</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-geographytypemapping-cs-LC38\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-geographytypemapping-cs-LC39\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">return</span> ((<span class=\"pl-en\">SqlGeography</span>)<span class=\"pl-smi\">value</span>).<span class=\"pl-en\">ToWkt</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-geographytypemapping-cs-LC40\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-geographytypemapping-cs-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-geographytypemapping-cs-LC41\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/GeographyTypeMapping.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-geographytypemapping-cs\">GeographyTypeMapping.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</p>\n<p>Далее, нам нужно добавить в SqlServerTypeMapper новый маппинг. Расширяем класс:</p>\n<p><div id=\"gist81001569\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-customsqlservertypemapper-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"blob-wrapper data type-c\">\n      <table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">CustomSqlServerTypeMapper</span> : <span class=\"pl-en\">SqlServerTypeMapper</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\">    {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">readonly</span> <span class=\"pl-en\">RelationalTypeMapping</span> <span class=\"pl-smi\">DbGeographyTypeMapping</span> </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">GeographyTypeMapping</span>(<span class=\"pl-smi\">SqlServerConstants</span>.<span class=\"pl-smi\">GeographyDataType</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">private</span> <span class=\"pl-en\">IReadOnlyDictionary</span>&lt;<span class=\"pl-en\">Type</span>, <span class=\"pl-en\">RelationalTypeMapping</span>&gt; <span class=\"pl-smi\">_clrTypeMappings</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">private</span> <span class=\"pl-en\">IReadOnlyDictionary</span>&lt;<span class=\"pl-k\">string</span>, <span class=\"pl-en\">RelationalTypeMapping</span>&gt; <span class=\"pl-smi\">_storeTypeMapping</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC9\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">public</span> <span class=\"pl-en\">CustomSqlServerTypeMapper</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC10\" class=\"blob-code blob-code-inner js-file-line\">            [<span class=\"pl-en\">NotNull</span>] <span class=\"pl-en\">RelationalTypeMapperDependencies</span> <span class=\"pl-smi\">dependencies</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC11\" class=\"blob-code blob-code-inner js-file-line\">            : <span class=\"pl-k\">base</span>(<span class=\"pl-smi\">dependencies</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC12\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC13\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC14\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC15\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">protected</span> <span class=\"pl-k\">override</span> IReadOnlyDictionary&lt;Type, RelationalTypeMapping&gt; </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC16\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-en\">GetClrTypeMappings</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC17\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC18\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span> Not synchronized but we don&#39;t really care</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC19\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">_clrTypeMappings</span> <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC20\" class=\"blob-code blob-code-inner js-file-line\">            {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC21\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-k\">var</span> <span class=\"pl-smi\">baseDictionary</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">base</span>.<span class=\"pl-en\">GetClrTypeMappings</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC22\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">var</span> <span class=\"pl-smi\">clrTypeMappings</span> </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC23\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">Dictionary</span>&lt;<span class=\"pl-en\">Type</span>, <span class=\"pl-en\">RelationalTypeMapping</span>&gt;(<span class=\"pl-smi\">baseDictionary</span>.<span class=\"pl-smi\">Count</span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC24\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-k\">foreach</span> (<span class=\"pl-k\">var</span> <span class=\"pl-smi\">keyValuePair</span> <span class=\"pl-k\">in</span> <span class=\"pl-smi\">baseDictionary</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC25\" class=\"blob-code blob-code-inner js-file-line\">                {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC26\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-smi\">clrTypeMappings</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-smi\">keyValuePair</span>.<span class=\"pl-smi\">Key</span>, <span class=\"pl-smi\">keyValuePair</span>.<span class=\"pl-smi\">Value</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC27\" class=\"blob-code blob-code-inner js-file-line\">                }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC28\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC29\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">clrTypeMappings</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-k\">typeof</span>(<span class=\"pl-en\">SqlGeography</span>), <span class=\"pl-smi\">DbGeographyTypeMapping</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC30\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">_clrTypeMappings</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">clrTypeMappings</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC31\" class=\"blob-code blob-code-inner js-file-line\">            }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC32\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC33\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">return</span> <span class=\"pl-smi\">_clrTypeMappings</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC34\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC35\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC36\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">protected</span> <span class=\"pl-k\">override</span> IReadOnlyDictionary&lt;string, RelationalTypeMapping&gt; </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC37\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-en\">GetStoreTypeMappings</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC38\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC39\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span> Not synchronized but we don&#39;t really care</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC40\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">_storeTypeMapping</span> <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC41\" class=\"blob-code blob-code-inner js-file-line\">            {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC42\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-k\">var</span> <span class=\"pl-smi\">baseDictionary</span> <span class=\"pl-k\">=</span> <span class=\"pl-k\">base</span>.<span class=\"pl-en\">GetStoreTypeMappings</span>();</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC43\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">var</span> <span class=\"pl-smi\">storeTypeMappings</span> </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC44\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-en\">Dictionary</span>&lt;<span class=\"pl-k\">string</span>, <span class=\"pl-en\">RelationalTypeMapping</span>&gt;(</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC45\" class=\"blob-code blob-code-inner js-file-line\">                        <span class=\"pl-smi\">baseDictionary</span>.<span class=\"pl-smi\">Count</span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC46\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-k\">foreach</span> (<span class=\"pl-k\">var</span> <span class=\"pl-smi\">keyValuePair</span> <span class=\"pl-k\">in</span> <span class=\"pl-smi\">baseDictionary</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC47\" class=\"blob-code blob-code-inner js-file-line\">                {</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC48\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-smi\">storeTypeMappings</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-smi\">keyValuePair</span>.<span class=\"pl-smi\">Key</span>, <span class=\"pl-smi\">keyValuePair</span>.<span class=\"pl-smi\">Value</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC49\" class=\"blob-code blob-code-inner js-file-line\">                }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC50\" class=\"blob-code blob-code-inner js-file-line\">                </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC51\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">storeTypeMappings</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-smi\">SqlServerConstants</span>.<span class=\"pl-smi\">GeographyDataType</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC52\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-smi\">DbGeographyTypeMapping</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC53\" class=\"blob-code blob-code-inner js-file-line\">                <span class=\"pl-smi\">_storeTypeMapping</span> <span class=\"pl-k\">=</span> <span class=\"pl-smi\">storeTypeMappings</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC54\" class=\"blob-code blob-code-inner js-file-line\">            }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC55\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L56\" class=\"blob-num js-line-number\" data-line-number=\"56\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC56\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">return</span> <span class=\"pl-smi\">_storeTypeMapping</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L57\" class=\"blob-num js-line-number\" data-line-number=\"57\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC57\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-customsqlservertypemapper-cs-L58\" class=\"blob-num js-line-number\" data-line-number=\"58\"></td>\n        <td id=\"file-customsqlservertypemapper-cs-LC58\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/CustomSqlServerTypeMapper.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-customsqlservertypemapper-cs\">CustomSqlServerTypeMapper.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</p>\n<p>Здесь можно озаботиться синхронизацией, но основная идея – переопределить методы GetClrTypeMappings и GetStoreTypeMappings добавив в них наш маппинг для географии.</p>\n<p>Далее осталось подменить IRelationalTypeMapper сервис нашей реализацией. Можно это сделать в ConfigureServices методе, а можно в вашем контексте переопределить OnConfiguring:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\">\n      <pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnConfiguring</span><span class=\"token punctuation\">(</span>\n  <span class=\"token class-name\">DbContextOptionsBuilder</span> optionsBuilder<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  optionsBuilder\n    <span class=\"token punctuation\">.</span><span class=\"token function\">ReplaceService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">OnConfiguring</span><span class=\"token punctuation\">(</span>optionsBuilder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Всё? Почти.</p>\n<p>Если вы используете InMemory провайдер для тестирования, вам нужно провернуть такую же фишку и в нём. К счастью, поддержка type mappings уже <a href=\"https://github.com/aspnet/EntityFrameworkCore/issues/8010\">доступна</a>. Здесь вам надо зарегистрировать в DI другой интерфейс (ITypeMapper вместо IRelationalTypeMapper). Загвоздка заключается в том, что при добавлении регистрации InMemoryDatabase через UseInMemoryDatabase не происходит регистрация класса RelationalTypeMapperDependencies, в итоге его нельзя просто подменить через ReplaceService. Что делать?</p>\n<p>Создаём ещё одного наследника:</p>\n<p><div id=\"gist81001569\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-testtypemapper-cs\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"blob-wrapper data type-c\">\n      <table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-testtypemapper-cs-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-testtypemapper-cs-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">TestTypeMapper</span> : <span class=\"pl-en\">CustomSqlServerTypeMapper</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-testtypemapper-cs-LC2\" class=\"blob-code blob-code-inner js-file-line\">    {</td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-testtypemapper-cs-LC3\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">public</span> <span class=\"pl-en\">TestTypeMapper</span>() </td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-testtypemapper-cs-LC4\" class=\"blob-code blob-code-inner js-file-line\">            : <span class=\"pl-k\">base</span>(<span class=\"pl-k\">new</span> <span class=\"pl-en\">RelationalTypeMapperDependencies</span>())</td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-testtypemapper-cs-LC5\" class=\"blob-code blob-code-inner js-file-line\">        {</td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-testtypemapper-cs-LC6\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-testtypemapper-cs-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-testtypemapper-cs-LC7\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09/raw/d34acc84db217c177eab9d540537d72d573869f3/TestTypeMapper.cs\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/DSilence/83aa0c7a9c02345c294d075f01ba7a09#file-testtypemapper-cs\">TestTypeMapper.cs</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</p>\n<p>После чего мы в наших тестах мы можем делать следующее:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\">\n      <pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">var</span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">YourContext</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DbContextOptionsBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">UseInMemoryDatabase</span><span class=\"token punctuation\">(</span>“Test”<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">ReplaceService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n      </div>\n<p>Вуаля!</p>","frontmatter":{"title":"Spatial типы и EFCore","date":"September 28, 2017"}}},"pageContext":{"slug":"/_posts/2017-09-28-spatial-d182d0b8d0bfd18b-d0b8-efcore/","previous":null,"next":null}}